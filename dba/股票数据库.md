> **[info] ChinaStocks：股票数据库**
> 目前我们自建中国股票的行情数据库，通过获取股票 `Tick` 实盘行情、编写处理脚本进行清洗、自动监控数据并最终录入数据库。 
> 同时，我们还采购了第三方的数据源，实现了上市公司基本信息、财务信息、行业信息等多个数据类型的日常更新。

目前主要有以下数据库

- `china_stocks_bar`：股票的行情数据，包含 `daily`、`minute`、`valuation`
    ```bash
    CREATE DATABASE `china_stocks_bar` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
    ```

- `china_stocks_info`：股票的基本信息数据，包含公司概况、财务数据、行业数据、指数成分
    ```bash
    CREATE DATABASE `china_stocks_info` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
    ```

# `china_stocks_bar`

## `daily`：日行情数据

```mysql
################################################################################
## china_stocks_bar.daily
################################################################################
CREATE TABLE  china_stocks_bar.daily(
    TradingDay      DATE             NOT NULL,          ## 交易日期
    ExchID          CHAR(2)          NOT NULL,          ## 交易所代码: 
    StockID         CHAR(6)          NOT NULL,          ## 股票代码: 
    StockName       VARCHAR(30),                        ## 股票名称: 
    #------------------------------------------------------
    Open            DECIMAL(10,3),                      ## 开盘价
    High            DECIMAL(10,3),                      ## 开盘价
    Low             DECIMAL(10,3),                      ## 开盘价
    Close           DECIMAL(10,3),                      ## 开盘价
    #-----------------------------------------------------
    BFactor         DECIMAL(15,6),                      ## 后复权因子
    #-----------------------------------------------------
    Volume          BIGINT,                             ## 交易量， 股
    Amount          DECIMAL(30,3),                      ## 交易额，元
    #-----------------------------------------------------
    UpperLimit      DECIMAL(10,3),                      ## 涨停价
    LowerLimit      DECIMAL(10,3),                      ## 跌停价
    Status          VARCHAR(30),                        ## 交易状态
    IsLimit         CHAR(10),                           ## 涨跌停标识
                                                        ## 1. u: 涨停
                                                        ## 2, l：跌停
    IfST            CHAR(10),                           ## 是否 st:
                                                        ## 1. y: 是st
                                                        ## 2. n：不是st
    #-----------------------------------------------------
    PRIMARY KEY (TradingDay, ExchID, StockID),          ## 主键唯一，重复不可输入
    KEY `TradingDay` (`TradingDay`),
    KEY `StockID` (`StockID`)
    );

##----------- INDEX --------------------------------------------------------- ##
CREATE INDEX index_daily
ON china_stocks_bar.daily
(TradingDay, StockID);  
## -------------------------------------------------------------------------- ## 


##----------- PARTITIONS ---------------------------------------------------- ##
ALTER TABLE china_stocks_bar.daily
    PARTITION BY RANGE( TO_DAYS(TradingDay) )(
    #---------------------------------------------------------------------------
    PARTITION p2001 VALUES LESS THAN (TO_DAYS('2001-01-01')),
    PARTITION p2002 VALUES LESS THAN (TO_DAYS('2002-01-01')),
    PARTITION p2003 VALUES LESS THAN (TO_DAYS('2003-01-01')),
    PARTITION p2004 VALUES LESS THAN (TO_DAYS('2004-01-01')),
    PARTITION p2005 VALUES LESS THAN (TO_DAYS('2005-01-01')),
    PARTITION p2006 VALUES LESS THAN (TO_DAYS('2006-01-01')),
    PARTITION p2007 VALUES LESS THAN (TO_DAYS('2007-01-01')),
    PARTITION p2008 VALUES LESS THAN (TO_DAYS('2008-01-01')),
    PARTITION p2009 VALUES LESS THAN (TO_DAYS('2009-01-01')),
    PARTITION p2010 VALUES LESS THAN (TO_DAYS('2010-01-01')),
    PARTITION p2011 VALUES LESS THAN (TO_DAYS('2011-01-01')),
    PARTITION p2012 VALUES LESS THAN (TO_DAYS('2012-01-01')),
    PARTITION p2013 VALUES LESS THAN (TO_DAYS('2013-01-01')),
    PARTITION p2014 VALUES LESS THAN (TO_DAYS('2014-01-01')),
    PARTITION p2015 VALUES LESS THAN (TO_DAYS('2015-01-01')),
    PARTITION p2016 VALUES LESS THAN (TO_DAYS('2016-01-01')),
    PARTITION p2017 VALUES LESS THAN (TO_DAYS('2017-01-01')),
    PARTITION p2018 VALUES LESS THAN (TO_DAYS('2018-01-01')),
    PARTITION p2019 VALUES LESS THAN (TO_DAYS('2019-01-01')),
    PARTITION p2020 VALUES LESS THAN (TO_DAYS('2020-01-01')),
    PARTITION p2021 VALUES LESS THAN (TO_DAYS('2021-01-01')),
    PARTITION p2022 VALUES LESS THAN (TO_DAYS('2022-01-01')),
    PARTITION p2023 VALUES LESS THAN (TO_DAYS('2023-01-01')),
    PARTITION p2024 VALUES LESS THAN (TO_DAYS('2024-01-01')),
    PARTITION p2025 VALUES LESS THAN (TO_DAYS('2025-01-01')),
    #--------------------------------------------------------------------------- 
    PARTITION pmax VALUES LESS THAN maxvalue
    );
## -------------------------------------------------------------------------- ## 
```

## `minute`：分钟行情数据

```mysql


################################################################################
## china_stocks_bar.minute
################################################################################
CREATE TABLE  china_stocks_bar.minute(
    TradingDay      DATE             NOT NULL,          ## 交易日期
    Minute          TIME             NOT NULL,          ## 分钟，
                                                        ## 格式为==> "HH:MM:SS"", 与 Wind 数据库类似
    ExchID          CHAR(2)          NOT NULL,          ## 交易所代码: 
    StockID         CHAR(6)          NOT NULL,          ## 股票代码:
    #------------------------------------------------------
    Open            DECIMAL(10,3),                      ## 开盘价
    High            DECIMAL(10,3),                      ## 开盘价
    Low             DECIMAL(10,3),                      ## 开盘价
    Close           DECIMAL(10,3),                      ## 开盘价
    #-----------------------------------------------------
    Volume          BIGINT,                             ## 交易量， 股
    Amount          DECIMAL(30,3),                      ## 交易额，元
    #-----------------------------------------------------
    PRIMARY KEY (TradingDay, Minute, ExchID, StockID),  ## 主键唯一，重复不可输入
    KEY `TradingDay` (`TradingDay`),
    KEY `StockID` (`StockID`)
    );

##----------- INDEX --------------------------------------------------------- ##
CREATE INDEX index_minute
ON china_stocks_bar.minute
(TradingDay, StockID);
## -------------------------------------------------------------------------- ##
```

## `valuation`：估值数据

```mysql

################################################################################
## china_stocks_bar.valuation
################################################################################
CREATE TABLE  china_stocks_bar.valuation(
    TradingDay      DATE             NOT NULL,          ## 交易日期
    ExchID          CHAR(2)          NOT NULL,          ## 交易所代码: 
    StockID         CHAR(6)          NOT NULL,          ## 股票代码: 
    #------------------------------------------------------
    TotalShares         BIGINT                          ,## 总股数
    CirculatingShares   BIGINT                          ,## 流通股数
    TotalCap            DECIMAL(30,3)                   ,## 总市值
    CirculatingCap      DECIMAL(30,3)                   ,## 流通市值
    #-----------------------------------------------------
    PE                  DECIMAL(10,5)                   ,
    PB                  DECIMAL(10,5)                   ,
    PCF                 DECIMAL(10,5)                   ,
    #-----------------------------------------------------
    PRIMARY KEY (TradingDay, ExchID, StockID),          ## 主键唯一，重复不可输入
    KEY `TradingDay` (`TradingDay`),
    KEY `StockID` (`StockID`)
    );

##----------- INDEX --------------------------------------------------------- ##
CREATE INDEX index_valuation
ON china_stocks_bar.valuation
(TradingDay, StockID);  
## -------------------------------------------------------------------------- ## 


##----------- PARTITIONS ---------------------------------------------------- ##
ALTER TABLE china_stocks_bar.valuation
    PARTITION BY RANGE( TO_DAYS(TradingDay) )(
    #---------------------------------------------------------------------------
    PARTITION p2001 VALUES LESS THAN (TO_DAYS('2001-01-01')),
    PARTITION p2002 VALUES LESS THAN (TO_DAYS('2002-01-01')),
    PARTITION p2003 VALUES LESS THAN (TO_DAYS('2003-01-01')),
    PARTITION p2004 VALUES LESS THAN (TO_DAYS('2004-01-01')),
    PARTITION p2005 VALUES LESS THAN (TO_DAYS('2005-01-01')),
    PARTITION p2006 VALUES LESS THAN (TO_DAYS('2006-01-01')),
    PARTITION p2007 VALUES LESS THAN (TO_DAYS('2007-01-01')),
    PARTITION p2008 VALUES LESS THAN (TO_DAYS('2008-01-01')),
    PARTITION p2009 VALUES LESS THAN (TO_DAYS('2009-01-01')),
    PARTITION p2010 VALUES LESS THAN (TO_DAYS('2010-01-01')),
    PARTITION p2011 VALUES LESS THAN (TO_DAYS('2011-01-01')),
    PARTITION p2012 VALUES LESS THAN (TO_DAYS('2012-01-01')),
    PARTITION p2013 VALUES LESS THAN (TO_DAYS('2013-01-01')),
    PARTITION p2014 VALUES LESS THAN (TO_DAYS('2014-01-01')),
    PARTITION p2015 VALUES LESS THAN (TO_DAYS('2015-01-01')),
    PARTITION p2016 VALUES LESS THAN (TO_DAYS('2016-01-01')),
    PARTITION p2017 VALUES LESS THAN (TO_DAYS('2017-01-01')),
    PARTITION p2018 VALUES LESS THAN (TO_DAYS('2018-01-01')),
    PARTITION p2019 VALUES LESS THAN (TO_DAYS('2019-01-01')),
    PARTITION p2020 VALUES LESS THAN (TO_DAYS('2020-01-01')),
    PARTITION p2021 VALUES LESS THAN (TO_DAYS('2021-01-01')),
    PARTITION p2022 VALUES LESS THAN (TO_DAYS('2022-01-01')),
    PARTITION p2023 VALUES LESS THAN (TO_DAYS('2023-01-01')),
    PARTITION p2024 VALUES LESS THAN (TO_DAYS('2024-01-01')),
    PARTITION p2025 VALUES LESS THAN (TO_DAYS('2025-01-01')),
    #--------------------------------------------------------------------------- 
    PARTITION pmax VALUES LESS THAN maxvalue
    );
## -------------------------------------------------------------------------- ##   
```


# `china_stocks_info`

## `onlisting`、`delisting`：上市/退市列表

```mysql
################################################################################
## china_stocks_info.onlisting
## 正在交易的股票
################################################################################
CREATE TABLE china_stocks_info.onlisting(
    StockID       CHAR(30)   NOT NULL,      ## 股票代码
    StockName     CHAR(30),                 ## 股票名称
    ## -------------------------------------------------------------------------
    StockID_B     CHAR(30),                 ## 股票代码B
    StockName_B   CHAR(30),                 ## 股票名称B
    ## -------------------------------------------------------------------------
    ExchID        CHAR(30)   NOT NULL,      ## 交易所代码, sh, sz    
    ## -------------------------------------------------------------------------
    ListingDate   DATE,                     ## 上市时间
    ## -------------------------------------------------------------------------
    PRIMARY KEY (StockID, ExchID)
);

################################################################################
## china_stocks_info.delisting
## 已经退市的股票
################################################################################
CREATE TABLE china_stocks_info.delisting(
    StockID       CHAR(30)   NOT NULL,      ## 股票代码
    StockName     CHAR(30),                 ## 股票名称
    ## -------------------------------------------------------------------------
    ExchID        CHAR(30)   NOT NULL,      ## 交易所代码, sh, sz    
    ## -------------------------------------------------------------------------
    ListingDate     DATE,                   ## 上市时间
    TerminatedDate  DATE,                   ## 退市时间
    ## -------------------------------------------------------------------------
  PRIMARY KEY (StockID, ExchID)
);
```

## `suspending`：停牌信息

```mysql

################################################################################
## china_stocks_info.suspending
## 已经退市的股票
################################################################################
CREATE TABLE china_stocks_info.suspending(
    TradingDay    DATE       NOT NULL,      ## 交易日期
    StockID       CHAR(30)   NOT NULL,      ## 股票代码
    StockName     CHAR(30),                 ## 股票名称
    ## -------------------------------------------------------------------------
    ExchID        CHAR(30)   NOT NULL,      ## 交易所代码, sh, sz    
    ## -------------------------------------------------------------------------
    SuspendStart  DATE,                     ## 停牌开始
    SuspendEnd    DATE,                     ## 停牌结束（到当日收盘）
    SuspendReason text,                     ## 停牌原因
    ## -------------------------------------------------------------------------
  PRIMARY KEY (TradingDay, StockID, ExchID)
);
```

### `limit`

```mysql

################################################################################
## china_stocks_info.limit_from_jrj
## 已经退市的股票
################################################################################
CREATE TABLE china_stocks_info.limit_from_jrj(
    TradingDay    DATE       NOT NULL,      ## 交易日期
    StockID       CHAR(30)   NOT NULL,      ## 股票代码
    ## -------------------------------------------------------------------------
    ExchID        CHAR(30)   NOT NULL,      ## 交易所代码, sh, sz    
    ## -------------------------------------------------------------------------
    Close         DECIMAL(10,3),            ## 开盘价
    Chgpct        DECIMAL(10,5),            ## 涨跌
    LimitType     CHAR(30)   NOT NULL,      ## 涨跌停
                                            ## upper: 涨停
                                            ## lower: 跌停
    ## -------------------------------------------------------------------------
  PRIMARY KEY (TradingDay, StockID, ExchID)
);
```

## `industry_class`：行业分类

```mysql
################################################################################
## china_stocks_info.industry_class_from_sw
################################################################################
CREATE TABLE  china_stocks_info.industry_class_from_sw(
    TradingDay      DATE             NOT NULL,          ## 交易日期
    stockID         CHAR(10)         NOT NULL,          ## 股票代码
    stockName       VARCHAR(30)      NOT NULL,          ## 股票名称
    #------------------------------------------------------
    industryLevel   CHAR(1),                            ## 行业分级
    industryID      VARCHAR(30),                        ## 行业分类
    industryName    VARCHAR(50),                        ## 行业分类
    #------------------------------------------------------
    startDate       DATE,                               ## 入选时间
    endDate         DATE,                               ## 剔除时间
    #-----------------------------------------------------
    PRIMARY KEY (TradingDay, stockID, industryLevel),   ## 主键唯一，重复不可输入
    KEY `TradingDay` (`TradingDay`),
    KEY `StockID` (`StockID`)
    );

##----------- INDEX --------------------------------------------------------- ##
CREATE INDEX index_industry_class_from_sw
ON china_stocks_info.industry_class_from_sw
(TradingDay, stockID, industryLevel);
## -------------------------------------------------------------------------- ##
```

## `allotment`：分红派息

```mysql
################################################################################
## china_stocks_info.allotment_from_em
################################################################################
CREATE TABLE  china_stocks_info.allotment_from_em(
    股票代码    CHAR(10),
    股票简称    VARCHAR(30),
    配股代码    CHAR(10),
    配股简称    VARCHAR(30),

    每10股配股比例    DECIMAL(5,3),
    配股价格          DECIMAL(10,3),      
    配股前总股本      DECIMAL(30,3),
    配股股本         DECIMAL(30,3),
    配股后总股本      DECIMAL(30,3),

    股权登记日        DATE,
    缴款起始日期       DATE,
    缴款截至日期       DATE,
    上市日期          DATE,
    除权基准日         DATE,

    实际募资总额      DECIMAL(30,3),
    实际募资净额      DECIMAL(30,3),
    #-----------------------------------------------------
    PRIMARY KEY (股票代码, 股权登记日, 上市日期),   ## 主键唯一，重复不可输入
    KEY `股票代码` (`股票代码`),
    KEY `股票简称` (`股票简称`)
    );

##----------- INDEX --------------------------------------------------------- ##
CREATE INDEX index_allotment_from_em
ON china_stocks_info.allotment_from_em
(股票代码, 股权登记日, 上市日期);
## -------------------------------------------------------------------------- ##
```
